---
import { getCollection, render, getEntry } from "astro:content";
import Layout from "../../layouts/Layout.astro";

export async function getStaticPaths() {
  const posts = await getCollection("posts");
  return posts.map((post) => ({
    params: { post: post.id },
    props: { post },
  }));
}

const { post } = Astro.props;
const { Content } = await render(post);
const categories = await Promise.all(
  post.data.categories.map((cat) => getEntry(cat)),
);
---

<Layout
  title={post.data.title}
  description={post.data.summary}
  type="article"
  publishedTime={post.data.date}
  author="Deanny Bruces"
  keywords={post.data.categories?.map((cat) => cat.id).join(", ")}
  image={post.data.image?.src}
>
  <div class="markdown">
    <div class="container">
      <h1 class="title" style={`view-transition-name: ${post.id}-title;`}>
        {post.data.title}
      </h1>
      <div class="pill-container">
        {
          categories.map((cat) => (
            <a
              href={`/blog/categories/${cat.id}`}
              class="pill"
              style={`--category-color: var(${cat.data.color})`}
            >
              {cat.data.name}
            </a>
          ))
        }
      </div>
      <img
        src={post.data.image.src}
        alt={`Imagen del artÃ­culo: ${post.data.title} - Blog de Deanny Bruces`}
        width={800}
        height={450}
        loading="lazy"
        class="post-image"
        style={`view-transition-name: ${post.id}-image;`}
      />
      <Content />
      <section class="comments">
        <h2>Comentarios</h2>
        <div id="disqus_thread"></div>
        <script>
          /**
           *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
           *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables    */
          /*
    var disqus_config = function () {
    this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
    this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    */
          // eslint-disable-next-line @typescript-eslint/no-unused-vars
          const disqus_config = function () {
            // @ts-expect-error disqus_config
            this.page.url = window.location.href; // Replace PAGE_URL with your page's canonical URL variable
            // @ts-expect-error disqus_config
            this.page.identifier = window.location.pathname; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
          };
          (function () {
            // DON'T EDIT BELOW THIS LINE
            const d = document,
              s = d.createElement("script");
            s.src = "https://www-deannybruces-com.disqus.com/embed.js";
            s.setAttribute("data-timestamp", `${new Date()}`);
            (d.head || d.body).appendChild(s);
          })();
        </script>
        <noscript
          >Please enable JavaScript to view the <a
            href="https://disqus.com/?ref_noscript"
            >comments powered by Disqus.</a
          ></noscript
        >
      </section>
    </div>
  </div>
</Layout>

<style>
  @import url("../../assets/styles/md.css");

  .pill-container {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    margin-bottom: 2rem;
  }

  .pill {
    display: inline-block;

    width: auto;
    margin-bottom: 1rem;
    padding: 0.2rem 0.6rem;
    border: 1px solid var(--category-color);
    border-radius: 4px;

    font-size: 1rem;
    line-height: 1.25;
    color: var(--category-color);
    text-decoration: none;
    text-transform: uppercase;

    transition: all 300ms ease-in-out;
  }

  .pill:hover {
    color: #fff;
    background-color: var(--category-color);
  }
</style>
