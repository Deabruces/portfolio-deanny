---
// Modern QR Code Generator Component
---

<div class="qr-generator-container">
  <div class="qr-generator-card">
    <!-- Header -->
    <div class="generator-header">
      <div class="header-icon">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="28"
          height="28"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
          aria-hidden="true"
          role="img"
        >
          <rect width="5" height="5" x="3" y="3" rx="1"></rect>
          <rect width="5" height="5" x="16" y="3" rx="1"></rect>
          <rect width="5" height="5" x="3" y="16" rx="1"></rect>
          <path d="M21 16h-3a2 2 0 0 0-2 2v3"></path>
          <path d="M21 21v.01"></path>
          <path d="M12 7v3a2 2 0 0 1-2 2H7"></path>
          <path d="M3 12h.01"></path>
          <path d="M12 3h.01"></path>
          <path d="M12 16v.01"></path>
          <path d="M16 12h1"></path>
          <path d="M21 12v.01"></path>
          <path d="M12 21v-1"></path>
        </svg>
      </div>
      <h2 class="generator-title">
        Generador de <span class="generator-title-gradient">C贸digos QR</span>
      </h2>
      <p class="generator-subtitle">
        Crea c贸digos QR personalizados para compartir URLs, textos o informaci贸n
        de contacto f谩cilmente
      </p>
    </div>

    <!-- Form -->
    <form id="qr-form" class="generator-form">
      <div class="form-group">
        <label for="url" class="form-label">
          <span class="label-icon" role="img" aria-label="Enlace"></span>
          URL o Texto
        </label>
        <input
          type="text"
          id="url"
          name="url"
          class="form-input"
          placeholder="https://www.tudominio.com o cualquier texto"
          required
          aria-describedby="url-help"
        />
        <small id="url-help" class="form-help">
          Ingresa una URL completa o cualquier texto que quieras convertir en
          c贸digo QR
        </small>
      </div>

      <div class="form-group">
        <label for="qr-size" class="form-label">
          <span class="label-icon" role="img" aria-label="Tama帽o"></span>
          Tama帽o del QR
        </label>
        <select id="qr-size" name="qr-size" class="form-select">
          <option value="200">Peque帽o (200x200)</option>
          <option value="300" selected>Mediano (300x300)</option>
          <option value="400">Grande (400x400)</option>
          <option value="500">Extra Grande (500x500)</option>
        </select>
      </div>

      <div class="form-actions">
        <button type="submit" class="btn btn-primary">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="18"
            height="18"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            aria-hidden="true"
          >
            <rect width="5" height="5" x="3" y="3" rx="1"></rect>
            <rect width="5" height="5" x="16" y="3" rx="1"></rect>
            <rect width="5" height="5" x="3" y="16" rx="1"></rect>
          </svg>
          Generar C贸digo QR
        </button>
        <button type="reset" class="btn btn-secondary">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="18"
            height="18"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            aria-hidden="true"
          >
            <path d="M3 6h18"></path>
            <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"></path>
            <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"></path>
          </svg>
          Limpiar
        </button>
      </div>
    </form>

    <!-- Output Section -->
    <div
      id="output-section"
      class="output-section hidden"
      aria-live="polite"
      aria-atomic="true"
    >
      <div class="output-header">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="20"
          height="20"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
          aria-hidden="true"
        >
          <polyline points="20 6 9 17 4 12"></polyline>
        </svg>
        <span>隆C贸digo QR Generado!</span>
      </div>

      <div class="qr-preview">
        <div id="qr-code" class="qr-code"></div>
      </div>

      <div class="output-actions">
        <a id="download-link" download="codigo-qr.png" class="btn btn-success">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="18"
            height="18"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            aria-hidden="true"
          >
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
            <polyline points="7 10 12 15 17 10"></polyline>
            <line x1="12" x2="12" y1="15" y2="3"></line>
          </svg>
          Descargar QR
        </a>
        <button id="copy-btn" type="button" class="btn btn-secondary">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="18"
            height="18"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            aria-hidden="true"
          >
            <rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect>
            <path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"
            ></path>
          </svg>
          Copiar Imagen
        </button>
      </div>
    </div>
  </div>
</div>

<style>
  .qr-generator-container {
    display: flex;
    align-items: center;
    justify-content: center;

    min-height: 60vh;
    padding: 2rem 1rem;
  }

  .qr-generator-card {
    width: 100%;
    max-width: 700px;
    padding: 2rem;
    border: 1px solid light-dark(rgb(195 140 246 / 30%), rgb(195 140 246 / 20%));
    border-radius: 1.5rem;

    background: light-dark(rgb(242 233 242 / 90%), rgb(113 58 126 / 30%));
    backdrop-filter: blur(10px);
    box-shadow: 0 20px 60px rgb(142 68 173 / 10%);
  }

  /* Header */
  .generator-header {
    margin-bottom: 2rem;
    text-align: center;
  }

  .header-icon {
    display: inline-flex;
    align-items: center;
    justify-content: center;

    width: 56px;
    height: 56px;
    margin-bottom: 1rem;
    border-radius: 0.875rem;

    color: white;

    background: linear-gradient(
      135deg,
      var(--deanny-purpura),
      var(--deanny-cian)
    );
    box-shadow: 0 10px 30px rgb(142 68 173 / 30%);
  }

  .header-icon svg {
    width: 28px;
    height: 28px;
  }

  .generator-title {
    margin: 0 0 0.75rem;

    font-size: 1.875rem;
    font-weight: 900;
    line-height: 1.2;
    color: var(--deanny-encabezados-text-color);
  }

  .generator-title-gradient {
    background: linear-gradient(135deg, #a855f7, #06b6d4, #ec4899);
    background-clip: text;
    background-clip: text;
    background-size: 200% 200%;

    animation: gradientShift 8s ease infinite;

    -webkit-text-fill-color: transparent;
  }

  .generator-subtitle {
    max-width: 550px;
    margin: 0;
    margin: 0 auto;

    font-size: 0.95rem;
    line-height: 1.5;
    color: var(--medium-contrast-text);
  }

  /* Form */
  .generator-form {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
  }

  .form-group {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  .form-label {
    display: flex;
    gap: 0.5rem;
    align-items: center;

    font-size: 0.875rem;
    font-weight: 700;
    color: var(--deanny-text-color);
  }

  .label-icon {
    font-size: 1.125rem;
  }

  .form-input,
  .form-select {
    padding: 0.75rem 1rem;
    border: 2px solid light-dark(rgb(195 140 246 / 30%), rgb(195 140 246 / 20%));
    border-radius: 0.75rem;

    font-family: inherit;
    font-size: 0.95rem;
    color: var(--deanny-text-color);

    background: light-dark(rgb(255 255 255 / 80%), rgb(26 26 26 / 50%));

    transition: all 0.3s ease;
  }

  .form-input::placeholder {
    color: var(--deanny-placeholder-text-color);
  }

  .form-input:focus,
  .form-select:focus {
    border-color: var(--deanny-purpura);
    outline: none;
    box-shadow: 0 0 0 3px rgb(142 68 173 / 10%);
  }

  .form-input:focus-visible,
  .form-select:focus-visible {
    outline: 3px solid var(--deanny-purpura);
    outline-offset: 2px;
  }

  .form-select {
    cursor: pointer;
  }

  .form-help {
    margin-top: -0.25rem;
    font-size: 0.8125rem;
    color: var(--low-contrast-text);
  }

  /* Buttons */
  .form-actions {
    display: flex;
    gap: 1rem;
    margin-top: 0.5rem;
  }

  .btn {
    cursor: pointer;

    display: inline-flex;
    flex: 1;
    gap: 0.5rem;
    align-items: center;
    justify-content: center;

    padding: 0.75rem 1.5rem;
    border: 2px solid var(--deanny-cian);
    border-radius: 0.75rem;

    font-size: 0.95rem;
    font-weight: 700;
    text-decoration: none;

    transition: all 0.3s ease;
  }

  .btn svg {
    width: 18px;
    height: 18px;
  }

  .btn-primary {
    color: white;
    background: linear-gradient(
      135deg,
      var(--deanny-purpura),
      var(--deanny-cian)
    );
    box-shadow: 0 4px 15px rgb(142 68 173 / 30%);
  }

  .btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgb(142 68 173 / 40%);
  }

  .btn:focus-visible,
  a.btn:focus-visible {
    outline: 3px solid var(--deanny-purpura);
    outline-offset: 3px;
  }

  .btn-secondary {
    border: 2px solid var(--deanny-border-color);
    color: var(--deanny-text-color);
    background: transparent;
  }

  .btn-secondary:hover {
    transform: translateY(-2px);
    background: light-dark(rgb(195 140 246 / 10%), rgb(195 140 246 / 20%));
  }

  .btn-success {
    color: white;
    background: var(--success-color);
    box-shadow: 0 4px 15px rgb(16 185 129 / 30%);
  }

  .btn-success:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgb(16 185 129 / 40%);
  }

  /* Output Section */
  .output-section {
    margin-top: 2rem;
    padding: 1.5rem;
    border: 2px solid var(--success-color);
    border-radius: 1rem;

    background: light-dark(rgb(16 185 129 / 5%), rgb(16 185 129 / 10%));
  }

  .output-section.hidden {
    display: none;
  }

  .output-header {
    display: flex;
    gap: 0.75rem;
    align-items: center;

    margin-bottom: 1.5rem;

    font-size: 1.125rem;
    font-weight: 700;
    color: var(--success-color);
  }

  .output-header svg {
    flex-shrink: 0;
  }

  .qr-preview {
    display: flex;
    align-items: center;
    justify-content: center;

    margin-bottom: 1.5rem;
    padding: 2rem;
    border: 1px solid light-dark(rgb(195 140 246 / 20%), rgb(195 140 246 / 10%));
    border-radius: 0.75rem;

    background: white;
  }

  .qr-code {
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .qr-code canvas {
    max-width: 100%;
    height: auto;
    border-radius: 0.5rem;
  }

  .output-actions {
    display: flex;
    gap: 1rem;
  }

  /* Reduce animations for users with motion sensitivity */
  @media (prefers-reduced-motion: reduce) {
    .generator-title-gradient {
      background-position: 0% 50%;
      animation: none;
    }

    .btn:hover,
    a.btn:hover {
      transform: none;
    }

    * {
      scroll-behavior: auto !important;
      transition-duration: 0.01ms !important;
      animation-duration: 0.01ms !important;
      animation-iteration-count: 1 !important;
    }
  }

  /* Responsive */
  @media (width < 768px) {
    .qr-generator-card {
      padding: 1.5rem;
    }

    .generator-title {
      font-size: 1.75rem;
    }

    .generator-subtitle {
      font-size: 0.875rem;
    }

    .form-actions,
    .output-actions {
      flex-direction: column;
    }

    .btn {
      width: 100%;
    }
  }

  @media (width < 480px) {
    .qr-generator-card {
      padding: 1.25rem;
    }

    .generator-title {
      font-size: 1.5rem;
    }

    .header-icon {
      width: 48px;
      height: 48px;
    }

    .header-icon svg {
      width: 24px;
      height: 24px;
    }

    .form-input,
    .form-select {
      padding: 0.625rem 0.875rem;
      font-size: 0.875rem;
    }

    .qr-preview {
      padding: 1rem;
    }
  }

  @keyframes gradientShift {
    0%,
    100% {
      background-position: 0% 50%;
    }

    50% {
      background-position: 100% 50%;
    }
  }
</style>

<script>
  import QRCode from "qrcode";

  const form = document.getElementById("qr-form")! as HTMLFormElement;
  const urlInput = document.getElementById("url")! as HTMLInputElement;
  const sizeSelect = document.getElementById("qr-size")! as HTMLSelectElement;
  const qrCodeContainer = document.getElementById("qr-code")!;
  const outputSection = document.getElementById("output-section")!;
  const downloadLink = document.getElementById(
    "download-link",
  )! as HTMLAnchorElement;
  const copyBtn = document.getElementById("copy-btn")! as HTMLButtonElement;
  const originalCopyText = copyBtn.innerHTML;

  form.addEventListener("submit", async (e) => {
    e.preventDefault();

    const url = urlInput.value.trim();
    const size = parseInt(sizeSelect.value);

    if (!url) return;

    // Clear previous QR code
    qrCodeContainer.innerHTML = "";

    try {
      // Generate QR code
      const canvas = document.createElement("canvas");
      await QRCode.toCanvas(canvas, url, {
        width: size,
        margin: 2,
        color: {
          dark: "#000000",
          light: "#FFFFFF",
        },
      });

      // Add canvas to container
      canvas.setAttribute("role", "img");
      canvas.setAttribute("aria-label", `C贸digo QR para: ${url}`);
      qrCodeContainer.appendChild(canvas);

      // Setup download link
      downloadLink.href = canvas.toDataURL("image/png");
      downloadLink.download = `qr-code-${Date.now()}.png`;

      // Show output section
      outputSection.classList.remove("hidden");

      // Scroll to output smoothly
      outputSection.scrollIntoView({ behavior: "smooth", block: "nearest" });
    } catch (err) {
      console.error("Error generating QR code:", err);
      alert(
        "Hubo un error al generar el c贸digo QR. Por favor, intenta de nuevo.",
      );
    }
  });

  // Copy QR code as image
  copyBtn.addEventListener("click", async () => {
    const canvas = qrCodeContainer.querySelector("canvas");
    if (!canvas) return;

    try {
      // Convert canvas to blob
      canvas.toBlob(async (blob) => {
        if (!blob) return;

        try {
          await navigator.clipboard.write([
            new ClipboardItem({ "image/png": blob }),
          ]);

          copyBtn.innerHTML = `
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="20 6 9 17 4 12"></polyline>
            </svg>
            隆Copiado!
          `;

          setTimeout(() => {
            copyBtn.innerHTML = originalCopyText;
          }, 2000);
        } catch (err) {
          console.error("Error copying image:", err);
          alert(
            "No se pudo copiar la imagen. Intenta descargarla en su lugar.",
          );
        }
      });
    } catch (err) {
      console.error("Error:", err);
      alert("No se pudo copiar la imagen. Intenta descargarla en su lugar.");
    }
  });

  // Reset form
  form.addEventListener("reset", () => {
    qrCodeContainer.innerHTML = "";
    outputSection.classList.add("hidden");
  });
</script>
