<form
  action="https://formsubmit.co/1a1ffeb0c7e37244eeecaf2edad1c061"
  class="form"
  method="POST"
  novalidate
  aria-labelledby="contact-form-title"
>
  <ul class="form__ul">
    <li class="form__li">
      <label class="form__label" for="name">Nombre y Apellido:</label>
      <input
        class="form-input"
        id="name"
        name="user_name"
        placeholder="tu nombre y apellido"
        required
        type="text"
        aria-describedby="name-error"
        autocomplete="name"
      />
      <span id="name-error" class="error-message" aria-live="polite"></span>
    </li>
    <li class="form__li">
      <label class="form__label" for="mail">Email:</label>
      <input
        class="form-input"
        id="mail"
        name="email"
        placeholder="tu email"
        required
        type="email"
        aria-describedby="email-error"
        autocomplete="email"
      />
      <span id="email-error" class="error-message" aria-live="polite"></span>
    </li>
    <li class="form__li">
      <label class="form__label" for="msg">Mensaje:</label>
      <textarea
        class="form__textarea"
        id="msg"
        name="user_message"
        placeholder="Ej.: Â¿QuÃ© tienes en mente?"
        required
        rows="6"
        aria-describedby="message-error"
      ></textarea>
      <span id="message-error" class="error-message" aria-live="polite"></span>
    </li>
    <div class="form__send">
      <input class="form-input__btn" type="submit" value="Â¡Hablemos!" aria-describedby="form-status" />
      <p class="form__response">
        Generalmente respondo dentro de 1 o 2 dÃ­as hÃ¡biles.
      </p>
    </div>
  </ul>
  <input name="_captcha" type="hidden" value="false" />
</form>

<div id="form-status" class="form-status" aria-live="polite" aria-atomic="true">
  <div class="gratitude hidden">
    Â¡Gracias por tu mensaje! Me pondrÃ© en contacto contigo pronto ðŸ˜Š
  </div>
  <div class="error hidden">
    Estoy teniendo problemas para entregar tu mensaje. Por favor, intenta de nuevo
    mÃ¡s tarde.
  </div>
</div>

<style>
  .hidden {
    opacity: 0;
  }

  .error-message {
    display: block;
    margin-top: 0.25rem;
    font-size: 0.875rem;
    color: var(--error-color);
    min-height: 1.25rem;
  }

  .form-status {
    margin-top: 1rem;
  }

  .form__ul {
    display: flex;
    flex-direction: column;
    align-items: start;
    padding-inline-start: 0;
  }

  .form__li {
    display: flex;
    flex-direction: column;

    width: 100%;
    margin-bottom: 2rem;

    list-style: none;
  }

  .form-input {
    width: 100%;
    height: 40px;
    border: 1px solid var(--acento-btn);
    border-radius: 5px;

    background-color: var(--background-color);
    outline: none;
  }

  .form__textarea {
    border: 1px solid var(--acento-btn);
    border-radius: 5px;
    background-color: var(--background-color);
    outline: none;
  }

  .form-input:focus,
  .form__textarea:focus {
    border: 2px solid var(--secondary-color);
  }

  .form-input::placeholder,
  .form__textarea::placeholder {
    padding: 1rem;
    color: var(--text-color);
    opacity: 0.5;
  }

  .form__send {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .form-input__btn {
    border: 1px solid var(--acento-btn);
    border-radius: 20px;

    font-weight: 600;
    color: white;

    background-color: var(--acento-btn);

    transition: all 300ms ease-in-out;
  }

  .form-input__btn[disabled] {
    cursor: not-allowed;
    background-color: var(--border-color);
  }

  .form-input__btn:hover {
    border: 1px solid var(--acento-btn-hover);
    color: white;
    background-color: var(--acento-btn-hover);
  }

  .form__response {
    margin-top: 0.5rem;
    font-size: 0.9rem;
    color: var(--text-color);
  }

  .gratitude {
    padding: 1rem;
    border: 1px solid var(--success-color);
    border-radius: 5px;
    color: var(--success-color);
    background-color: light-dark(#f0fdf4, #0f1b0f);
    transition: opacity 0.3s;
  }

  .error {
    padding: 1rem;
    border: 1px solid var(--error-color);
    border-radius: 5px;
    color: var(--error-color);
    background-color: light-dark(#fef2f2, #1f1315);
    transition: opacity 0.3s;
  }
</style>

<script>
  const form = document.querySelector<HTMLFormElement>(".form");
  const ok = document.querySelector(".gratitude");
  const errorM = document.querySelector(".error");

  const showGratitude = (e: SubmitEvent) => {
    e.preventDefault();
    console.log("enviando");
    const button =
      document.querySelector<HTMLButtonElement>(".form-input__btn");
    button!.disabled = true;
    const formulario = e.target as HTMLFormElement;
    const data = new FormData(formulario);
    const url = formulario.action;
    const method = formulario.method;
    fetch(url, { body: data, method })
      .then(() => {
        ok?.classList.remove("hidden");
        console.log("enviado");
      })
      .catch(() => {
        errorM?.classList.remove("hidden");
      })
      .finally(() => {
        button!.disabled = false;
        formulario.reset();
        setTimeout(() => {
          ok?.classList.add("hidden");
          errorM?.classList.add("hidden");
        }, 3000);
      });
  };
  form?.addEventListener("submit", showGratitude);
</script>
